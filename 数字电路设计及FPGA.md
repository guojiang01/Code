# 数字电路设计及FPGA

### 一门最好的语言就是在你的环境里已经使用的语言或者是客户要求使用的语言 

1. 同步时序电路：包含环路的环，它的输出直接反馈到输入，它们是时许电路而不是组合电路。组合逻辑没有环路和竞争。为了避免这些问题，设计师在路径中插入寄存器来断开环路。将电路转变成组合逻辑和寄存器的集合。寄存器包含系统的状态，这些状态仅仅在时钟到达时发生改变，所有说状态**同步于**时钟信号。如果时钟足够慢，使得在下一个时钟沿到达之前输入到寄存器的信号都可以稳定下来，那么所有的竞争都将被消除。

2. **同步时序电路**有一个时钟输入，它的上升沿表示时序电路状态转变发生的事件。我们经常使用术语*当前状态*和*下一个状态*来区分目前系统的状态和下一个时钟沿系统将要进入的状态。

3. 时序规范包括上界时间$t_{pcq}$和下界时间$t_{ccq}$ ，它是从时钟的上升沿知道**输出**改变的时间以及**建立**时间$t_{setup}$和**保持**时间$t_{hold}$,它表示当前**输入**必须相对于时钟的上升沿稳定。

4. **同步时序电路的组成**规则告诉我们，一个电路是同步时序电路，如果它由相互连接的电路元件构成，且需要满足一下条件。
   + 每一个电路元件是寄存器或者是组合电路
   + 至少有一个元件是寄存器
   + 所有寄存器都接收同一个时钟信号
   + 每个环路至少包含一个寄存器

5. 两种常见的同步时序电路成为**有限状态机**和**流水线**

6. 由电路图导出状态机
   + 检查电路，标明输入、输出和状态位
   + 写出下一个状态和输出表
   + 创建下一个状态和输出表
   + 删除不可达状态来简化下一个状态表
   + 给每个有效状态位组合指定状态名称
   + 用状态名称重写下一个状态和输出表
   + 画出状态转换图
   + 使用文字阐述有限状态机的功能

7. 有限状态机小结

   + 确定输入和输出
   + 画出状态转换图
   + 对于$Moore$型状态机：
     + 写出状态转换表
     + 写出输出表

   + 对于$Mealy$型状态机：
     + 写出组合的状态转换表和输出表

   + 选择状态编码——这个选择将影响硬件设计
   + 为下一个状态和输出逻辑写出布尔表达式
   + 画出电路草图

8. **动态约束**

   为了电路对输入正确采样，在时钟上升沿到来前，输入必须在*建立时间*(setup time) $t_{setup}$内保持稳定，在时钟上升沿后，输入必须保持至少*保持时间*（hold time）$t_{hold}$内保持稳定。建立时间和保持时间统称为电路的*孔径时间*，因为它是输入保持稳定状态的时间总和。

   **动态约束**是指同步时序电路的输入必须在时钟沿附近的建立和维持孔径时间内保持稳定

9. **建立时间约束** 

   $t_{pd}\leq T_c-(t_{pcp}+t_{setup})$ 制造商确定触发器时钟到$Q$的传播延迟$t_{pcq}$和建立时间$t_{setup}$.在圆括号内的项$t_{pd}+t_{setup}$称为*时序开销*。理想状态下，整个周期时间$T_c$都应用于组合逻辑中有用的计算，其传播延迟为$t_{pd}$。但是，触发器的时序开销占用了周期时间。上式称为*建立时间约束*或*最大延迟约束*，因为它取决于建立时间，并限制通过组合逻辑的最大延迟。
   
   + 解决问题的方法有两个：增加时钟周期或重新设计组合逻辑来缩短传播延迟

10. **保持时间约束**

    $t_{cd}\geq t_{hold}-t_{ccq}$ 称为*保持时间约束*或者*最小延迟约束*，因为它限制了通过组合逻辑的最小延迟。如果不能满足，则唯一的解决方法是重新设计电路以便增加组合逻辑的最小延迟。与建立约束不同，他们不能通过调整时钟周期来改正。

11. 数字系统设计人员的目标是：对于给定的异步输入，确保遇到的亚稳态电压的概率足够小。为了确保产生正确的逻辑电平，所有的异步输入必须经过*同步器* 。

    + 用2个触发器来建立同步器的简单方法。$F1$在$CLK$的上升沿对$D$进行采样，如果$D$在这个时刻发生改变，则输出$D2$将出现暂时的亚稳态。如果时钟周期足够长，则在周期结束前$D2$成为一个有效逻辑电平的概率很高。然后$F2$对$D2$进行采样，它现在是稳定的，将产生一个好的输出$Q$ ($F1$$F2$为$D$触发器)

    + 如果同步器的输出$Q$为亚稳态，那么这个同步器将*失效*。

    + 系统的可靠性通常由**平均失效间隔时间（MTBF）**度量。根据定义可以看出,**MTBF**是系统失效之间的平均时间。它是系统失效概率的倒数：

      **MTBF**=$\frac1{P(失效)/sec}$=$\frac{T_ce^{T_c-t_{setup}}}{NT_0}$ 

12. 系统的速度可以用延迟和通过系统的信息吞吐量来度量。**任务**定义为经过处理后能产生一组输出的一组输入。**延迟**是从开始到结束所需的时间。**吞吐量**是系统单位时间内产生的任务的数量

13. 与输出只取决于当前输入的组合逻辑电路相比，时许逻辑电路的输出取决于当前和先前的输入。换句话说，时许逻辑电路记忆先前的输入信息。这种记忆称为逻辑的状态
    + 时许逻辑电路很难分析，并用以产生设计错误，所以我们只关心小部分成熟的模块。需要掌握的最重要元器件就是触发器，它接收时钟和输入$D$，产生一个输出$Q$。触发器在时钟的上升沿将$D$复制到$Q$，其他时候保持$Q$原来的状态。共享一个公共时钟的触发器称为寄存器。触发器还可以接收复位和使能控制信号。
    + 虽然有多种形式的时许逻辑，但我们只考虑最容易设计的同步时许逻辑电路。同步时许逻辑电路包含由时钟驱动寄存器隔开的组合逻辑块。电路的状态存储在寄存器中，仅在时钟沿到达时进行更新。
    + 同步时许逻辑电路的时序规范包括时钟到$Q$的传播延迟$t_{pcq}$和最小延迟$t_{ccq}$，建立时间$t_{setup}$和保持时间$t_{hold}$。为了正确操作，它们的输入在孔径时间内必须稳定。孔径时间在时钟的上升沿之前启动建立时间，在时钟的上升沿之后结束保持时间。系统的最小延迟周期$T_c$等于通过组合逻辑块的传播延迟$t_{pd}$加上寄存器的$t_{pcq}+t_{setup}$。为了正确操作，通过寄存器和组合逻辑的最小延迟必须大于$t_{hold}$。与常见的误解相反，**保持时间不影响周期时间**


14. 